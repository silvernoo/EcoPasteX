# EcoPaste 完整系统架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                         EcoPaste 客户端                              │
│                    (Tauri + React + TypeScript)                     │
│                                                                     │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  偏好设置 → Webhook 配置                                      │  │
│  │  ✓ 启用 Webhook                                              │  │
│  │  ✓ URL: http://localhost:8080/api/webhook                   │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  当用户复制内容时...                                                │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              │ POST /api/webhook
                              │ {type, value, timestamp, subtype}
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         后端 API 服务                                │
│                      (Go + Gin Framework)                           │
│                                                                     │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  Webhook 处理器                                               │  │
│  │  • 接收 POST 请求                                             │  │
│  │  • 验证数据格式                                               │  │
│  │  • 提取预览内容                                               │  │
│  │  • 清理 HTML 标签                                             │  │
│  │  • 识别图片类型                                               │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                              │                                      │
│                              ▼                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  数据库操作层                                                 │  │
│  │  • 插入新记录                                                 │  │
│  │  • 查询历史记录                                               │  │
│  │  • 删除记录                                                   │  │
│  │  • 索引优化                                                   │  │
│  └──────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              │ MongoDB Driver
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         MongoDB 数据库                               │
│                                                                     │
│  Database: ecopaste                                                 │
│  Collection: clipboard                                              │
│                                                                     │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  Document 结构:                                               │  │
│  │  {                                                            │  │
│  │    _id: ObjectId,                                             │  │
│  │    type: "text" | "image" | "html" | "rtf" | "files",        │  │
│  │    value: "实际内容",                                          │  │
│  │    timestamp: ISODate,                                        │  │
│  │    subtype: "plain" | "html" | ...,                           │  │
│  │    isImage: Boolean,                                          │  │
│  │    preview: "预览文本"                                         │  │
│  │  }                                                            │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  Index: timestamp (降序)                                            │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              │ GET /api/clipboard
                              │ ?page=1&pageSize=100&type=all&search=
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         前端 Web 应用                                │
│                    (Vue 3 + Tailwind CSS)                           │
│                                                                     │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  🔍 搜索栏                                                    │  │
│  │  ┌────────────────────────────────────────────────────────┐  │  │
│  │  │ 🔍 搜索剪贴板内容...                                    │  │  │
│  │  └────────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  🏷️ 筛选按钮                                                  │  │
│  │  [全部] [文本] [图片]                                         │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  📋 内容列表                                                  │  │
│  │  ┌────────────────────────────────────────────────────────┐  │  │
│  │  │ [文本] 2 分钟前                              [删除 🗑️]  │  │  │
│  │  │ CollectOneListAdapter                                  │  │  │
│  │  └────────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────────┐  │  │
│  │  │ [图片] 5 分钟前                              [删除 🗑️]  │  │  │
│  │  │ [图片预览]                                             │  │  │
│  │  └────────────────────────────────────────────────────────┘  │  │
│  │  ...                                                          │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  📄 分页控件                                                  │  │
│  │  [上一页] [1] [2] [3] ... [下一页]                           │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  自动刷新: 每 30 秒                                                 │
└─────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════

                            部署架构

┌─────────────────────────────────────────────────────────────────────┐
│                         Docker Compose                              │
│                                                                     │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐    │
│  │   MongoDB       │  │   Backend       │  │   Frontend      │    │
│  │   Container     │  │   Container     │  │   Container     │    │
│  │                 │  │                 │  │                 │    │
│  │   Port: 27017   │  │   Port: 8080    │  │   Port: 80      │    │
│  │   Volume:       │  │   Go Binary     │  │   Nginx +       │    │
│  │   mongodb_data  │  │                 │  │   Static Files  │    │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘    │
│         │                     │                     │              │
│         └─────────────────────┴─────────────────────┘              │
│                          Docker Network                            │
└─────────────────────────────────────────────────────────────────────┘
         │                      │                      │
         │                      │                      │
    localhost:27017       localhost:8080         localhost:3000


═══════════════════════════════════════════════════════════════════════

                            数据流向

用户复制内容
    │
    ├─→ EcoPaste 客户端检测到剪贴板变化
    │
    ├─→ Webhook 队列管理器
    │   • 排队发送
    │   • 失败重试（最多 3 次）
    │
    ├─→ POST http://localhost:8080/api/webhook
    │   {
    │     "type": "text",
    │     "value": "<html>...</html>",
    │     "timestamp": "2023-11-28T10:00:00Z",
    │     "subtype": "html"
    │   }
    │
    ├─→ 后端接收并处理
    │   • 清理 HTML: "CollectOneListAdapter"
    │   • 生成预览: "CollectOneListAdapter"
    │   • 标记类型: isImage = false
    │
    ├─→ 保存到 MongoDB
    │   {
    │     "_id": ObjectId("..."),
    │     "type": "text",
    │     "value": "<html>...</html>",
    │     "timestamp": ISODate("2023-11-28T10:00:00Z"),
    │     "subtype": "html",
    │     "isImage": false,
    │     "preview": "CollectOneListAdapter"
    │   }
    │
    └─→ 前端自动刷新（30 秒）或用户手动刷新
        • GET /api/clipboard?page=1&pageSize=100
        • 显示在列表顶部
        • 用户可以搜索、筛选、删除


═══════════════════════════════════════════════════════════════════════

                            技术栈总览

┌─────────────────────────────────────────────────────────────────────┐
│                         技术选型理由                                 │
│                                                                     │
│  后端 - Go + Gin                                                    │
│  ✓ 高性能、低内存占用                                               │
│  ✓ 并发处理能力强                                                   │
│  ✓ 编译型语言，部署简单                                             │
│  ✓ Gin 框架轻量级、路由快速                                         │
│                                                                     │
│  数据库 - MongoDB                                                   │
│  ✓ NoSQL，灵活的文档结构                                            │
│  ✓ 适合存储非结构化数据                                             │
│  ✓ 查询性能优秀                                                     │
│  ✓ 易于扩展                                                         │
│                                                                     │
│  前端 - Vue 3 + Tailwind CSS                                        │
│  ✓ Vue 3 Composition API 简洁高效                                   │
│  ✓ Tailwind 实用优先，开发快速                                      │
│  ✓ Vite 构建速度快                                                  │
│  ✓ 现代化、响应式设计                                               │
│                                                                     │
│  部署 - Docker + Docker Compose                                     │
│  ✓ 一键部署，环境一致                                               │
│  ✓ 服务隔离，易于管理                                               │
│  ✓ 数据持久化                                                       │
│  ✓ 易于扩展和迁移                                                   │
└─────────────────────────────────────────────────────────────────────┘
